/*! kahe 0.6.4 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.kahe=e()}(this,function(){"use strict";function t(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return Object.assign?Object.assign.apply(Object,[t].concat(e)):(e.forEach(function(e){e&&Object.keys(e).forEach(function(n,i){e.hasOwnProperty(i)&&(t[i]=n)})}),t)}function e(t){return Array.isArray(t)}function n(t){return void 0!==t}function i(t){return!(!t||1!==t.nodeType)}function r(t){return"function"==typeof t}function o(t){return"object"==typeof t&&!e(t)}function a(t){return"string"==typeof t}function s(t){return void 0===t}function c(){}function u(t,e){return"/"!=t[0]&&(t="/"+t),t=t.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?|\*/g,function(t,n,i,r,o,a){return"*"===t?(e.push(void 0),t):(e.push(r),n=n||"",(a?"":n)+"(?:"+(a?n:"")+(i||"")+(o||"([^/]+?)")+")"+(a||""))}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$","i")}function f(t){return"true"===t?t=!0:"false"===t?t=!1:"null"===t?t=null:"undefined"===t?t=void 0:!1===isNaN(t)&&(t=Number(t)),t}function h(t){for(var e=this,n=null,i=0,r=this.routes.length;i<r&&!(n=e.routes[i].match(t));i++);return n}function l(t){var e=window.location.href;this.go(e,{replace:!0})}function p(t){t||(t=window.event);var e=t.target;if(!(t.defaultPrevented||t.ctrlKey||t.metaKey||t.shiftKey||0!==t.button)){for(;e&&"A"!=e.nodeName;)e=e.parentNode;e&&e.href&&(e.target||-1==e.href.indexOf(this.base)||"external"==e.getAttribute("rel")||e.hasAttribute("download")||(t.preventDefault(),this.go(e.href)))}}var d=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];this.views=t};d.prototype.init=function(t,e){this.execute("init",t,e)},d.prototype.resize=function(t,e){this.views.forEach(function(n){r(n.resize)&&n.resize(t,e)})},d.prototype.animateIn=function(t,e){this.resize(window.innerWidth,window.innerHeight),this.execute("animateIn",t,e)},d.prototype.animateOut=function(t,e){var n=this;this.execute("animateOut",t,function(){n.destroy(t,c),e()})},d.prototype.destroy=function(t,e){this.execute("destroy",t,e)},d.prototype.execute=function(t,e,n){function i(){++a===o&&n()}var o=0,a=0;this.views.forEach(function(e){r(e[t])&&o++}),o?this.views.forEach(function(n){r(n[t])&&n[t].call(n,e,i)}):n()};var v={init:function(t){this.overlap=!n(t.overlap)||t.overlap,this.current=null,this.incoming=null,this.outgoing=null},resize:function(t,e){this.current&&this.current.resize(t,e)},show:function(t,e){var n=this,i=new(Function.prototype.bind.apply(d,[null].concat(e)));this.incoming=i,this.outgoing=this.current,i.init(t,function(){return n.swap(t)})},swap:function(t){var e=this,n=this.incoming,i=this.outgoing;this.current=n;var r=function(){e.incoming=null},o=function(){n.animateIn(t,r)},a=function(e){i.animateOut(t,e||c)};i?this.overlap?(a(),o()):a(o):o()}},w=Object.create(v),g=function(e){var n={};return t(e,{on:function(t,e,i){return(n[t]||(n[t]=[])).push({callback:e,context:i}),this},off:function(t,e){if(s(t))return n={},this;var i=n[t],r=[];if(i&&e)for(var o=0,a=i.length;o<a;o++)i[o].callback!==e&&i[o].callback.ref!==e&&r.push(i[o]);return r.length?n[t]=r:delete n[t],this},emit:function(t){for(var e=this,i=[],r=arguments.length-1;r-- >0;)i[r]=arguments[r+1];for(var o=n[t]||[],a=0,s=o.length;a<s;a++){var c=o[a].context||e;o[a].callback.apply(c,i)}return this}})},y=/^(view|hash|keys|params|path|query|regex|splats|url)$/,b=function(t,n){var i=this;e(n)&&(n={view:n}),this.keys=[],this.regex=u(t,this.keys),this.view=n.view||n,Object.keys(n).forEach(function(t){y.test(t)||(i[t]=n[t])})};b.prototype.match=function(e){var n=this,i=e.match(this.regex);if(!i)return!1;var r={},o=[];i.forEach(function(t,e){var a=n.keys[e],s=decodeURIComponent(i[e+1]);a?r[a]=f(s):"undefined"!==s&&o.push(s)});var a=t({path:e,params:r,splats:o},this);return delete a.keys,delete a.regex,a};var m={init:function(t){var e=this;this.base=window.location.protocol+"//"+window.location.host+(t.base||"/"),this.routes=[],this.resolved=null;var n=t.routes||{};n["*"]||(n["*"]=n["/"]?"/":c),Object.keys(n).forEach(function(t){var i=n[t],r=new b(t,i);e.routes.push(r)})},start:function(){window.addEventListener("popstate",l.bind(this)),document.addEventListener("click",p.bind(this)),this.go(window.location.href,{replace:!0})},go:function(t,e){void 0===e&&(e={}),"/"!==(t=t.replace(this.base,"")).charAt(0)&&(t="/"+t);var n=t.split(/[?#]/)[0];if(n!=this.resolved){var i=h.call(this,n);if(i){if("string"==typeof i.view)return this.go(i.view);window.history[e.replace?"replaceState":"pushState"]({},"",t),this.resolved=n,this.emit("route",i)}}}},x=Object.create(m),O=g(x),k=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,E=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,j=function(t,r){for(var s,c,u=o(r)?r:{},f=3===arguments.length?arguments[2]:r,h={tag:"div",attrs:{}},l=[];s=k.exec(t);)if(""===s[1]&&n(s[2]))h.tag=s[2];else if("#"===s[1])h.attrs.id=s[2];else if("."===s[1])l.push(s[2]);else if("["===s[3][0]){var p=E.exec(s[3]);h.attrs[p[1]]=p[3]||!p[2]||""}for(c in u)"class"===c?l=l.concat(u[c].split(" ")):u.hasOwnProperty(c)&&(h.attrs[c]=u[c]);var d=document.createElement(h.tag);l.length&&(w=d.classList).add.apply(w,l);for(c in h.attrs)!function(){var t=h.attrs[c];"style"===c?a(t)?d.style.cssText=t:Object.keys(t).forEach(function(e){return d.style[e]=t[e]}):c in d?d[c]=t:d.setAttribute(c,t)}();if(i(f))d.appendChild(f);else if(a(f)||!isNaN(f)){var v=document.createTextNode(f);d.appendChild(v)}else e(f)&&f.forEach(function(t){a(t)&&(t=document.createTextNode(t)),d.appendChild(t)});return d;var w};return function(t){function n(t){var n=(e(t.view)?t.view:[t.view]).map(function(t){return r(t)?new t:Object.create(t)});w.show(t,n)}void 0===t&&(t={}),w.init(t),O.init(t),O.on("route",n);var i=O.go.bind(O);return g({h:j,go:i,start:function(){if(window.addEventListener("resize",function(t){var e=window.innerWidth,n=window.innerHeight;w.resize(e,n)}),r(t.preloader)){var e=O.start.bind(O);n({view:t.preloader.bind(null,e)})}else O.start();this.start=c}})}});
