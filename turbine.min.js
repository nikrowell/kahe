/*! @nikrowell/turbine 0.1.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.turbine=e()}(this,function(){"use strict";function t(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return Object.assign?Object.assign.apply(Object,[t].concat(e)):(e.forEach(function(e){e&&Object.keys(e).forEach(function(n,i){e.hasOwnProperty(i)&&(t[i]=n)})}),t)}function e(t){return Array.isArray(t)}function n(t){return"boolean"==typeof t}function i(t){return void 0!==t}function r(t){return!(!t||1!==t.nodeType)}function o(t){return"function"==typeof t}function s(t){return null===t}function u(t){return"number"==typeof t}function c(t){return"object"==typeof t}function a(t){return"string"==typeof t}function h(t){return void 0===t}function f(){}function l(t,e){return"/"!=t[0]&&(t="/"+t),t=t.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?|\*/g,function(t,n,i,r,o,s){return"*"===t?(e.push(void 0),t):(e.push(r),n=n||"",(s?"":n)+"(?:"+(s?n:"")+(i||"")+(o||"([^/]+?)")+")"+(s||""))}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$","i")}function p(t){return"true"==t?t=!0:"false"==t?t=!1:"null"==t?t=null:"undefined"==t?t=void 0:0==isNaN(t)&&(t=Number(t)),t}function d(t){var e=window.location.href;this.go(e,{replace:!0})}function v(t){t||(t=window.event);var e=t.target;if(!(t.defaultPrevented||t.ctrlKey||t.metaKey||t.shiftKey||0!==t.button)){for(;e&&"A"!=e.nodeName;)e=e.parentNode;e&&e.href&&(e.target||-1==e.href.indexOf(this.base)||"external"==e.getAttribute("rel")||e.hasAttribute("download")||(t.preventDefault(),this.go(e.href)))}}function y(t){for(var e=j(t.controller)?t.controller:[t.controller],n=[],i=0,r=e.length;i<r;i++)n[i]=A(e[i])?new e[i]:Object.create(e[i]);var o=new(Function.prototype.bind.apply(m,[null].concat(n)));this.views.show(o,t)}var g=function(){var t=0;return function(e){return void 0===e&&(e=""),e+(++t+"")}}(),w=Object.freeze({extend:t,guid:g,isArray:e,isBoolean:n,isDefined:i,isElement:r,isFunction:o,isNull:s,isNumber:u,isObject:c,isString:a,isUndefined:h,noop:f}),b={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({callback:e,context:n}),this},once:function(t,e,n){var i=arguments,r=this,o=function(){r.off(t,o),e.apply(n,i)};return o.ref=e,this.on(t,o,n),this},trigger:function(t){for(var e=this,n=[],i=arguments.length-1;i-- >0;)n[i]=arguments[i+1];for(var r=this.e||(this.e={}),o=r[t]||[],s=0,u=o.length;s<u;s++){var c=o[s].context||e;o[s].callback.apply(c,n)}return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],r=[];if(i&&e)for(var o=0,s=i.length;o<s;o++)i[o].callback!==e&&i[o].callback.ref!==e&&r.push(i[o]);return r.length?n[t]=r:delete n[t],this}},m=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];this.views=t};m.prototype.init=function(t,e){this.execute("init",t,e)},m.prototype.resize=function(t,e){this.views.forEach(function(n){o(n.resize)&&n.resize(t,e)})},m.prototype.animateIn=function(t,e){var n=this;this.resize(window.innerWidth,window.innerHeight),setTimeout(function(){n.execute("animateIn",t,e)})},m.prototype.animateOut=function(t,e){var n=this;this.execute("animateOut",t,function(){n.destroy(t,f),e()})},m.prototype.destroy=function(t,e){this.execute("destroy",t,e)},m.prototype.execute=function(t,e,n){function i(){++s===r&&n()}var r=0,s=0;if(this.views.forEach(function(e){o(e[t])&&r++}),!r)return void n();this.views.forEach(function(n){o(n[t])&&n[t].call(n,e,i)})};var x=/^(controller|hash|keys|params|path|query|regex|splats|url)$/,O=function(t,n){var i=this;e(n)&&(n={controller:n}),this.keys=[],this.regex=l(t,this.keys),this.controller=n.controller||n,Object.keys(n).forEach(function(t){x.test(t)||(i[t]=n[t])})};O.prototype.match=function(e){var n=this,i=e.match(this.regex);if(!i)return!1;var r={},o=[];i.forEach(function(t,e){var s=n.keys[e],u=decodeURIComponent(i[e+1]);s?r[s]=p(u):"undefined"!==u&&o.push(u)});var s=t({path:e,params:r,splats:o},this);return delete s.keys,delete s.regex,Object.freeze(s)};var k=function(e){var n=this;this.base=window.location.protocol+"//"+window.location.host+(e.base||"/"),this.routes=[],this.resolved=null;var i=e.routes;i["*"]||(i["*"]=f),Object.keys(i).forEach(function(t){var e=i[t],r=new O(t,e);n.routes.push(r)}),t(this,b)};k.prototype.start=function(){window.addEventListener("popstate",d.bind(this)),document.addEventListener("click",v.bind(this)),this.go(window.location.href,{replace:!0})},k.prototype.match=function(t){for(var e=this,n=null,i=0,r=this.routes.length;i<r&&!(n=e.routes[i].match(t));i++);return n},k.prototype.go=function(t,e){void 0===e&&(e={}),t=t.replace(this.base,""),"/"!==t.charAt(0)&&(t="/"+t);var n=t.split(/[?#]/)[0];if(n!=this.resolved){var i=this.match(n);i&&(this.resolved=n,window.history&&window.history[e.replace?"replaceState":"pushState"]({},"",t),this.trigger("route",i))}};var z=function(t){this.overlap=!i(t.overlap)||t.overlap,this.current=null,this.incoming=null};z.prototype.resize=function(t,e){this.current&&this.current.resize(t,e)},z.prototype.show=function(t,e){var n=this;this.request=e,this.current!==t&&this.incoming!==t&&(this.incoming&&this.incoming.destroy(e,f),this.incoming=t,t.init(e,function(){return n.swap(t)}))},z.prototype.swap=function(t){var e=this,n=this.overlap,i=this.request,r=this.current,o=function(t){r.animateOut(i,t||f)},s=function(){e.current=t,e.incoming=null,t.animateIn(i,f)};if(!r)return void s();if(n)o(),s();else{o(s)}};var E=t,j=e,A=o,N=c,I=f,q=function(t){this.setup=t,this.utils=w,E(this,b)};return q.prototype.start=function(){var t=this,e=function(e){if(t.views=new z(e),t.router=new k(e),t.router.on("route",y.bind(t)),t.router.on("route",t.trigger.bind(t,"route")),window.addEventListener("resize",t.resize.bind(t)),e.intro){var n=t.router.start.bind(t.router),i=e.intro.bind(null,n);y.call(t,{controller:i})}else t.router.start()},n=A(this.setup)?this.setup(e):this.setup;return N(n)&&e(n),delete this.setup,this.start=I,this},q.prototype.resize=function(){var t=window.innerWidth,e=window.innerHeight;return this.views.resize(t,e),this.trigger("resize",{width:t,height:e}),this},q.prototype.go=function(t){return this.router.go(t),this},function(t){return new q(t)}});
